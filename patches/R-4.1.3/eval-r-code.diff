Index: R-4.1.3/src/main/main.c
===================================================================
--- R-4.1.3.orig/src/main/main.c
+++ R-4.1.3/src/main/main.c
@@ -311,6 +311,35 @@ struct EM_ReplContext {
     int browselevel;
 } EM_ctx;
 
+SEXP EMSCRIPTEN_KEEPALIVE evalRCode(const char *evalString, int *error) {
+    SEXP evalSEXP, exprSEXP;
+    SEXP resultSEXP = R_NilValue;
+    ParseStatus status;
+    *error = 0;
+
+    // Parse the given string into an R expression
+    PROTECT(evalSEXP = allocVector(STRSXP, 1));
+    SET_STRING_ELT(evalSEXP, 0, mkChar(evalString));
+    exprSEXP = PROTECT(R_ParseVector(evalSEXP, -1, &status, R_NilValue));
+
+    if (status != PARSE_OK) {
+        UNPROTECT(2);
+        *error = -1;
+        return R_NilValue;
+    }
+
+    // Evaluate the resulting R expression
+    for(int i=0; i<length(exprSEXP); i++) {
+        resultSEXP = R_tryEval(VECTOR_ELT(exprSEXP, i), R_GlobalEnv, error);
+        if (*error) {
+            UNPROTECT(2);
+            return R_NilValue;
+        }
+    }
+    UNPROTECT(2);
+    return resultSEXP;
+}
+
 int EMSCRIPTEN_KEEPALIVE runRCode(unsigned char* evalString, unsigned int n) {
     char *endline;
     int status;
