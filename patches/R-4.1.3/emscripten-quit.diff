Index: R-4.1.3/src/main/main.c
===================================================================
--- R-4.1.3.orig/src/main/main.c
+++ R-4.1.3/src/main/main.c
@@ -1502,8 +1502,13 @@ SEXP attribute_hidden do_quit(SEXP call,
     }
     /* run the .Last function. If it gives an error, will drop back to main
        loop. */
+#ifdef __EMSCRIPTEN__
+    if(runLast) R_dot_Last();
+    return(R_NilValue);
+#else
     R_CleanUp(ask, status, runLast);
     exit(0);
+#endif
     /*NOTREACHED*/
 }
 
