Index: R-4.1.3/src/main/main.c
===================================================================
--- R-4.1.3.orig/src/main/main.c
+++ R-4.1.3/src/main/main.c
@@ -1442,8 +1442,13 @@ SEXP attribute_hidden do_quit(SEXP call,
     }
     /* run the .Last function. If it gives an error, will drop back to main
        loop. */
+#ifdef __EMSCRIPTEN__
+    if(runLast) R_dot_Last();
+    EM_ASM(globalThis.Module.webr.exit());
+#else
     R_CleanUp(ask, status, runLast);
     exit(0);
+#endif
     /*NOTREACHED*/
 }
 
